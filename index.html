<!DOCTYPE html>
<html>
<head>
<title>Print Label</title>
<style>
img {
  max-width: 300px;
  height: auto;
}

.button {
  background-color: #0099ff;
  border: none;
  color: white;
  padding: 5px 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  transition-duration: 0.2s;
}

.button:hover {
  background-color: #66c2ff;
  color: white;
}

</style>
<script src="DYMO.Label.Framework.js" type="text/javascript" charset="UTF-8"> </script>

<script>

(function()
{
    function onload()
    {
        //Get URL paramaters
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const company = urlParams.get("co");
        const ticket = urlParams.get("srid");
        
        // define label XML
        var labelXml = "<?xml version=\"1.0\" encoding=\"utf-8\"?>" +
	"<DesktopLabel Version=\"1\">" +
	"  <DYMOLabel Version=\"3\">" +
	"    <Description>DYMO Label</Description>" +
	"    <Orientation>Landscape</Orientation>" +
	"    <LabelName>LargeShipping</LabelName>" +
	"    <InitialLength>0</InitialLength>" +
	"    <BorderStyle>SolidLine</BorderStyle>" +
	"    <DYMORect>" +
	"      <DYMOPoint>" +
	"        <X>0.2333333</X>" +
	"        <Y>0.05666666</Y>" +
	"      </DYMOPoint>" +
	"      <Size>" +
	"        <Width>3.706667</Width>" +
	"        <Height>2.216667</Height>" +
	"      </Size>" +
	"    </DYMORect>" +
	"    <BorderColor>" +
	"      <SolidColorBrush>" +
	"        <Color A=\"1\" R=\"0\" G=\"0\" B=\"0\"> </Color>" +
	"      </SolidColorBrush>" +
	"    </BorderColor>" +
	"    <BorderThickness>1</BorderThickness>" +
	"    <Show_Border>False</Show_Border>" +
	"    <DynamicLayoutManager>" +
	"      <RotationBehavior>ClearObjects</RotationBehavior>" +
	"      <LabelObjects>" +
	"        <TextObject>" +
	"          <Name>Return Address</Name>" +
	"          <Brushes>" +
	"            <BackgroundBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"0\" R=\"1\" G=\"1\" B=\"1\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </BackgroundBrush>" +
	"            <BorderBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"1\" R=\"0\" G=\"0\" B=\"0\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </BorderBrush>" +
	"            <StrokeBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"1\" R=\"0\" G=\"0\" B=\"0\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </StrokeBrush>" +
	"            <FillBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"0\" R=\"1\" G=\"1\" B=\"1\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </FillBrush>" +
	"          </Brushes>" +
	"          <Rotation>Rotation0</Rotation>" +
	"          <OutlineThickness>1</OutlineThickness>" +
	"          <IsOutlined>False</IsOutlined>" +
	"          <BorderStyle>SolidLine</BorderStyle>" +
	"          <Margin>" +
	"            <DYMOThickness Left=\"0\" Top=\"0\" Right=\"0\" Bottom=\"0\" />" +
	"          </Margin>" +
	"          <HorizontalAlignment>Center</HorizontalAlignment>" +
	"          <VerticalAlignment>Middle</VerticalAlignment>" +
	"          <FitMode>AlwaysFit</FitMode>" +
	"          <IsVertical>False</IsVertical>" +
	"          <FormattedText>" +
	"            <FitMode>AlwaysFit</FitMode>" +
	"            <HorizontalAlignment>Center</HorizontalAlignment>" +
	"            <VerticalAlignment>Middle</VerticalAlignment>" +
	"            <IsVertical>False</IsVertical>" +
	"            <LineTextSpan>" +
	"              <TextSpan>" +
	"                <Text>COMPANY_NAME</Text>" +
	"                <FontInfo>" +
	"                  <FontName>Arial</FontName>" +
	"                  <FontSize>28.4</FontSize>" +
	"                  <IsBold>True</IsBold>" +
	"                  <IsItalic>False</IsItalic>" +
	"                  <IsUnderline>False</IsUnderline>" +
	"                  <FontBrush>" +
	"                    <SolidColorBrush>" +
	"                      <Color A=\"1\" R=\"0\" G=\"0\" B=\"0\"> </Color>" +
	"                    </SolidColorBrush>" +
	"                  </FontBrush>" +
	"                </FontInfo>" +
	"              </TextSpan>" +
	"            </LineTextSpan>" +
	"          </FormattedText>" +
	"          <ObjectLayout>" +
	"            <DYMOPoint>" +
	"              <X>0.2401575</X>" +
	"              <Y>0.1141732</Y>" +
	"            </DYMOPoint>" +
	"            <Size>" +
	"              <Width>3.543307</Width>" +
	"              <Height>0.6338583</Height>" +
	"            </Size>" +
	"          </ObjectLayout>" +
	"        </TextObject>" +
	"        <LineObject>" +
	"          <Name>Line</Name>" +
	"          <Brushes>" +
	"            <BackgroundBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"0\" R=\"1\" G=\"1\" B=\"1\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </BackgroundBrush>" +
	"            <BorderBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"1\" R=\"0\" G=\"0\" B=\"0\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </BorderBrush>" +
	"            <StrokeBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"1\" R=\"0\" G=\"0\" B=\"0\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </StrokeBrush>" +
	"            <FillBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"0\" R=\"1\" G=\"1\" B=\"1\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </FillBrush>" +
	"          </Brushes>" +
	"          <Rotation>Rotation0</Rotation>" +
	"          <OutlineThickness>1</OutlineThickness>" +
	"          <IsOutlined>False</IsOutlined>" +
	"          <BorderStyle>SolidLine</BorderStyle>" +
	"          <Margin>" +
	"            <DYMOThickness Left=\"0\" Top=\"0\" Right=\"0\" Bottom=\"0\" />" +
	"          </Margin>" +
	"          <StrokeWidth>1</StrokeWidth>" +
	"          <DashPattern>SolidLine</DashPattern>" +
	"          <LineType>Horizontal</LineType>" +
	"          <ObjectLayout>" +
	"            <DYMOPoint>" +
	"              <X>0.2333333</X>" +
	"              <Y>0.8333333</Y>" +
	"            </DYMOPoint>" +
	"            <Size>" +
	"              <Width>3.645833</Width>" +
	"              <Height>0.125</Height>" +
	"            </Size>" +
	"          </ObjectLayout>" +
	"        </LineObject>" +
	"        <AddressObject>" +
	"          <Name>Address</Name>" +
	"          <Brushes>" +
	"            <BackgroundBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"0\" R=\"1\" G=\"1\" B=\"1\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </BackgroundBrush>" +
	"            <BorderBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"1\" R=\"0\" G=\"0\" B=\"0\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </BorderBrush>" +
	"            <StrokeBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"1\" R=\"0\" G=\"0\" B=\"0\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </StrokeBrush>" +
	"            <FillBrush>" +
	"              <SolidColorBrush>" +
	"                <Color A=\"0\" R=\"1\" G=\"1\" B=\"1\"> </Color>" +
	"              </SolidColorBrush>" +
	"            </FillBrush>" +
	"          </Brushes>" +
	"          <Rotation>Rotation0</Rotation>" +
	"          <OutlineThickness>1</OutlineThickness>" +
	"          <IsOutlined>False</IsOutlined>" +
	"          <BorderStyle>SolidLine</BorderStyle>" +
	"          <Margin>" +
	"            <DYMOThickness Left=\"0\" Top=\"0\" Right=\"0\" Bottom=\"0\" />" +
	"          </Margin>" +
	"          <HorizontalAlignment>Center</HorizontalAlignment>" +
	"          <VerticalAlignment>Middle</VerticalAlignment>" +
	"          <FitMode>AlwaysFit</FitMode>" +
	"          <IsVertical>False</IsVertical>" +
	"          <FormattedText>" +
	"            <FitMode>AlwaysFit</FitMode>" +
	"            <HorizontalAlignment>Center</HorizontalAlignment>" +
	"            <VerticalAlignment>Middle</VerticalAlignment>" +
	"            <IsVertical>False</IsVertical>" +
	"            <LineTextSpan>" +
	"              <TextSpan>" +
	"                <Text>Ticket #TICKET_NUMBER</Text>" +
	"                <FontInfo>" +
	"                  <FontName>Arial</FontName>" +
	"                  <FontSize>35.3</FontSize>" +
	"                  <IsBold>True</IsBold>" +
	"                  <IsItalic>False</IsItalic>" +
	"                  <IsUnderline>False</IsUnderline>" +
	"                  <FontBrush>" +
	"                    <SolidColorBrush>" +
	"                      <Color A=\"1\" R=\"0\" G=\"0\" B=\"0\"> </Color>" +
	"                    </SolidColorBrush>" +
	"                  </FontBrush>" +
	"                </FontInfo>" +
	"              </TextSpan>" +
	"            </LineTextSpan>" +
	"          </FormattedText>" +
	"          <BarcodePosition>None</BarcodePosition>" +
	"          <ObjectLayout>" +
	"            <DYMOPoint>" +
	"              <X>0.2333333</X>" +
	"              <Y>1.010417</Y>" +
	"            </DYMOPoint>" +
	"            <Size>" +
	"              <Width>3.541667</Width>" +
	"              <Height>1.186111</Height>" +
	"            </Size>" +
	"          </ObjectLayout>" +
	"        </AddressObject>" +
	"      </LabelObjects>" +
	"    </DynamicLayoutManager>" +
	"  </DYMOLabel>" +
	"  <LabelApplication>Blank</LabelApplication>" +
	"  <DataTable>" +
	"    <Columns></Columns>" +
	"    <Rows></Rows>" +
	"  </DataTable>" +
	"</DesktopLabel>";
        
		//Replace placeholders with content from parameters
        labelXml = labelXml.replace("COMPANY_NAME", company).replace("TICKET_NUMBER", ticket);
		
		//Create label object
		var label = dymo.label.framework.openLabelXml(labelXml);
        
		//Render label preview
		try {
			var pngData = label.render();
			var labelImage = document.getElementById('labelImage');
			labelImage.src = "data:image/png;base64," + pngData;
		} catch (ex) {
			document.body.innerHTML = "DYMO Label Framework was unable to render label. Check to ensure the Dymo Web Service is installed and running."
			return;
		}

                
        // Set button to print on click
		var printButton = document.getElementById('printButton');
        printButton.onclick = function()
        {
            try
            {
                // Select printer
                // For simplicity's sake we are using the first connected LabelWriter printer
                var printers = dymo.label.framework.getPrinters();
                if (printers.length == 0)
                    throw "No DYMO printers are installed. Install DYMO printers.";

                var printerName = "";
                for (var i = 0; i < printers.length; ++i)
                {
                    var printer = printers[i];
                    if (printer.printerType == "LabelWriterPrinter" && printer.isConnected)
                    {
                        printerName = printer.name;
                        break;
                    }
                }
                
                if (printerName == "")
                    throw "No LabelWriter printers found. Install LabelWriter printer";

                //print the label
				var printNumber = Math.min(10, document.getElementById("printNumber").value);
				var paramsXML = dymo.label.framework.createLabelWriterPrintParamsXml({ copies: printNumber });
				dymo.label.framework.printLabel(printerName, paramsXML, label.getLabelXml())
            }
            catch(e)
            {
                alert(e.message || e);
            }
        }
    };

   function initTests()
	{
		if(dymo.label.framework.init)
		{
			dymo.label.framework.init(onload);
		} else {
			document.body.innerHTML = "DYMO Label Framework JS library not loaded."
			return;
		}
	}

	// register onload event
	if (window.addEventListener)
		window.addEventListener("load", initTests, false);
	else if (window.attachEvent)
		window.attachEvent("onload", initTests);
	else
		window.onload = initTests;

} ());
</script>

</head>
<body>

<p id="preview">
<img id="labelImage" src="" alt="Loading label preview..." />
</p>
<br />
Click below to print label.
<div id="printDiv">
	<button id="printButton" class="button">Print</button>
	<input type="number" id="printNumber" value="1" size="4" max="10" min="1"/>
</div>

</body>
</html>
